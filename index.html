<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MIDCARE© — Mid-West Acute Hospital Bed Allocation Dashboard</title>
  <style>
    :root { 
      --bg:#ffffff; 
      --panel:#f8fafc; 
      --ink:#111111; 
      --muted:#555555; 
      --accent:#0d9488;
      --border:#e5e7eb;
      --navy:#1e3a8a;
      --blue:#60a5fa;
      --teal:#0ea5a8;
      --surplus:#16a34a;
      --shortfall:#dc2626;
      --gray:#6b7280;
    }
    *{box-sizing:border-box}
    body{ margin:0; background:var(--bg); color:var(--ink); font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif }
    header{ padding:24px 22px; border-bottom:1px solid var(--border); background:#ffffff; }
    .title-row{ display:flex; align-items:center; gap:12px; flex-wrap:wrap; }
    .title-logo{ height:44px; width:auto; }
    h1{ margin:0; font-size:24px; letter-spacing:.3px; color:var(--navy); }
    .wrap{ display:grid; grid-template-columns:330px 1fr; gap:18px; align-items:start; padding:18px 18px 28px }
    .card{ background:var(--panel); border:1px solid var(--border); border-radius:16px; box-shadow:0 6px 16px rgba(0,0,0,.06) }
    .controls{padding:14px 14px 6px}
    .group{ padding:12px 12px 10px; border:1px solid var(--border); border-radius:12px; margin-bottom:12px; background:#ffffff; }
    .group h3{ margin:0 0 8px; font-size:14px; color:var(--muted); font-weight:600; letter-spacing:.2px }
    .row{ display:grid; grid-template-columns:1fr 70px; align-items:center; gap:10px; margin:8px 0 }
    .row label{font-size:13px;color:#1f2937}
    input[type="range"]{width:100%}
    .val{font-variant-numeric:tabular-nums;color:#334155;font-size:13px;text-align:right}
    .btn{ background:var(--navy); color:#fff; border:1px solid var(--navy); padding:8px 12px; border-radius:10px; font-weight:700; cursor:pointer }
    .btn:hover{ background:#172554 }
    select{ padding:6px 8px; border:1px solid var(--border); border-radius:8px; background:#fff; }
    #stage{height:560px; width:100%;}
    svg{width:100%; height:560px; display:block}
    footer{color:var(--muted);text-align:center;font-size:12px;padding:10px}
    @media (max-width: 900px){ .wrap{grid-template-columns:1fr} svg{height:500px} }
  </style>
</head>
<body>
  <header>
    <div class="title-row">
      <img class="title-logo" src="https://assets.zyrosite.com/AoP61N2BR4i8Q6jl/logo-hsml-AE07eKDgMLFgWBoQ.png" alt="HSML Logo">
      <h1>MIDCARE© — Mid-West Acute Hospital Bed Allocation Dashboard</h1>
    </div>
  </header>
  <div class="wrap">
    <aside class="card">
      <div class="controls">
        <div class="group" style="display:flex; gap:8px; justify-content:flex-end;">
          <button class="btn" id="resetBtn">Reset to defaults</button>
        </div>

        <div class="group">
          <h3>Gap mode</h3>
          <div class="row" style="grid-template-columns:1fr;">
            <label for="gapMode">How should we measure the gap?</label>
            <select id="gapMode">
              <option value="baseline" selected>Baseline stock (planned vs current beds)</option>
              <option value="parity">Parity (allocation vs population)</option>
            </select>
          </div>
        </div>

        <div class="group">
          <h3>Reference Line</h3>
          <div class="row">
            <label for="ref">Reference (%)</label>
            <div class="val"><span id="ref-val">52.2</span>%</div>
          </div>
          <input id="ref" type="range" min="0" max="100" value="52.2" step="0.1">
        </div>

        <div class="group">
          <h3>Limerick</h3>
          <div class="row"><label>Population Proportion (%)</label><div class="val"><span id="pop-val-0">52.2</span>%</div></div>
          <input id="pop-0" type="range" min="0" max="100" step="0.1" value="52.2">
          <div class="row"><label>Resource Allocation (%)</label><div class="val"><span id="alloc-val-0">85</span>%</div></div>
          <input id="alloc-0" type="range" min="0" max="100" step="0.1" value="85">
        </div>

        <div class="group">
          <h3>Clare</h3>
          <div class="row"><label>Population Proportion (%)</label><div class="val"><span id="pop-val-1">31.9</span>%</div></div>
          <input id="pop-1" type="range" min="0" max="100" step="0.1" value="31.9">
          <div class="row"><label>Resource Allocation (%)</label><div class="val"><span id="alloc-val-1">10</span>%</div></div>
          <input id="alloc-1" type="range" min="0" max="100" step="0.1" value="10">
        </div>

        <div class="group">
          <h3>North Tipperary</h3>
          <div class="row"><label>Population Proportion (%)</label><div class="val"><span id="pop-val-2">15.9</span>%</div></div>
          <input id="pop-2" type="range" min="0" max="100" step="0.1" value="15.9">
          <div class="row"><label>Resource Allocation (%)</label><div class="val"><span id="alloc-val-2">5</span>%</div></div>
          <input id="alloc-2" type="range" min="0" max="100" step="0.1" value="5">
        </div>
      </div>
    </aside>
    <main class="card">
      <div id="stage">
        <svg id="chartSvg" viewBox="0 0 960 560" preserveAspectRatio="xMidYMid meet"></svg>
      </div>
    </main>
  </div>
  <footer>
    Use the sliders to adjust population and allocation. The "Gap mode" controls difference metrics:
    <b>Baseline stock</b> = planned beds. <b>Parity</b> = allocation − population, with bed equivalent.
  </footer>

  <script>
    const NAMES = ['Limerick','Clare','North Tipperary'];
    const popInputs = [ 'pop-0','pop-1','pop-2' ].map(id => document.getElementById(id));
    const allocInputs = [ 'alloc-0','alloc-1','alloc-2' ].map(id => document.getElementById(id));
    const popVals = [ 'pop-val-0','pop-val-1','pop-val-2' ].map(id => document.getElementById(id));
    const allocVals = [ 'alloc-val-0','alloc-val-1','alloc-val-2' ].map(id => document.getElementById(id));
    const gapModeSelect = document.getElementById('gapMode');

    const defaults = {
      ref: 52.2,
      pops: [52.2, 31.9, 15.9],
      allocs: [85, 10, 5],
      gapMode: 'baseline'
    };

    // Baselines used to convert allocation % -> bed counts
    const baseline = {
      'Limerick':        { pct: 85, beds: 310, parts: [184,84,42] },   // 310 total = 184+84+42
      'Clare':           { pct: 10, beds: 48 },
      'North Tipperary': { pct:  5, beds: 24 }
    };

    const svg = document.getElementById('chartSvg');
    const PAD = {l:80,r:30,t:40,b:70};
    const W = 960, H = 560;

    function clearSVG(){ while(svg.firstChild) svg.removeChild(svg.firstChild); }

    function drawAxes(maxY){
      // grid + ticks
      for(let y=0;y<=maxY;y+=10){
        const yy = H-PAD.b - (y/maxY)*(H-PAD.t-PAD.b);
        const grid = document.createElementNS('http://www.w3.org/2000/svg','line');
        grid.setAttribute('x1', PAD.l); grid.setAttribute('x2', W-PAD.r);
        grid.setAttribute('y1', yy); grid.setAttribute('y2', yy);
        grid.setAttribute('stroke', '#e5e7eb'); grid.setAttribute('stroke-width','1');
        grid.setAttribute('opacity', y%20===0 ? 1:0.5);
        svg.appendChild(grid);

        const label = document.createElementNS('http://www.w3.org/2000/svg','text');
        label.setAttribute('x', PAD.l-10); label.setAttribute('y', yy+4);
        label.setAttribute('text-anchor','end'); label.setAttribute('fill','#111111');
        label.setAttribute('font-size','12');
        label.textContent = y;
        svg.appendChild(label);
      }
      // vertical Y title at left, centered
      const midY = PAD.t + (H - PAD.t - PAD.b) / 2;
      const yTitle = document.createElementNS('http://www.w3.org/2000/svg','text');
      yTitle.setAttribute('x', 28);
      yTitle.setAttribute('y', midY);
      yTitle.setAttribute('fill', '#555555');
      yTitle.setAttribute('font-size', '12');
      yTitle.setAttribute('text-anchor', 'middle');
      yTitle.setAttribute('transform', `rotate(-90 28 ${midY})`);
      yTitle.textContent = 'Percentage';
      svg.appendChild(yTitle);
    }

    function scaleBeds(name, pct){
      const base = baseline[name];
      if(!base) return { total: 0, parts: [] };
      if (Math.abs(pct - base.pct) < 1e-9) {
        return { total: base.beds, parts: base.parts ? base.parts.slice() : [] };
      }
      const factor = pct / base.pct;
      const total = Math.round(base.beds * factor);
      if(base.parts){
        let parts = base.parts.map(v => Math.round(v * factor));
        let diff = total - parts.reduce((a,b)=>a+b,0);
        if(diff !== 0){
          const idx = parts.indexOf(Math.max(...parts));
          parts[idx] += diff;
        }
        return { total, parts };
      }
      return { total, parts: [] };
    }

    function draw(){
      clearSVG();
      const pop = popInputs.map(el => parseFloat(el.value));
      const alloc = allocInputs.map(el => parseFloat(el.value));
      const maxY = Math.max(100, ...pop, ...alloc);
      drawAxes(maxY);

      // reference line
      const ref = parseFloat(document.getElementById('ref').value);
      document.getElementById('ref-val').textContent = ref.toFixed(1);
      const yRef = H-PAD.b - (ref/maxY)*(H-PAD.t-PAD.b);
      const refLine = document.createElementNS('http://www.w3.org/2000/svg','line');
      refLine.setAttribute('x1', PAD.l-10); refLine.setAttribute('x2', W-PAD.r);
      refLine.setAttribute('y1', yRef); refLine.setAttribute('y2', yRef);
      refLine.setAttribute('stroke', '#0d9488'); refLine.setAttribute('stroke-dasharray','6,6'); refLine.setAttribute('stroke-width','2');
      svg.appendChild(refLine);

      // title
      const title = document.createElementNS('http://www.w3.org/2000/svg','text');
      title.setAttribute('x', (W/2)); title.setAttribute('y', 26);
      title.setAttribute('text-anchor','middle'); title.setAttribute('fill','#111111');
      title.setAttribute('font-size','16'); title.textContent = 'Resource Allocation vs. Population Proportion';
      svg.appendChild(title);

      // legend
      const mode = gapModeSelect.value;
      const legendItems = [
        ['#0ea5a8','Resource Allocation (%)'],
        ['#60a5fa','Population Proportion (%)'],
        ...(mode==='parity' ? [['#16a34a','Surplus vs parity (+)'], ['#dc2626','Shortfall vs parity (–)']] : [['#16a34a','Surplus vs baseline (+)'], ['#dc2626','Shortfall vs baseline (–)']])
      ];
      const legendY = PAD.t + 16;
      const startX = W - PAD.r - 520;
      legendItems.forEach((d, j)=>{
        const gX = startX + (j%2)*260;
        const gY = legendY + Math.floor(j/2)*20;
        const box = document.createElementNS('http://www.w3.org/2000/svg','rect');
        box.setAttribute('x', gX); box.setAttribute('y', gY-12);
        box.setAttribute('width', 14); box.setAttribute('height', 14); box.setAttribute('fill', d[0]); svg.appendChild(box);
        const txt = document.createElementNS('http://www.w3.org/2000/svg','text');
        txt.setAttribute('x', gX+22); txt.setAttribute('y', gY);
        txt.setAttribute('fill','#111111'); txt.setAttribute('font-size','12'); txt.textContent = d[1]; svg.appendChild(txt);
      });

      // bars
      const groups = NAMES.length; const band = (W-PAD.l-PAD.r)/groups; const gap = 18;
      const barW = (band - gap)/2;

      NAMES.forEach((name, i) => {
        const x0 = PAD.l + i*band;
        // alloc bar (left)
        const hA = (alloc[i]/maxY)*(H-PAD.t-PAD.b);
        const yA = H-PAD.b - hA;
        const rectA = document.createElementNS('http://www.w3.org/2000/svg','rect');
        rectA.setAttribute('x', x0 + gap/2);
        rectA.setAttribute('y', yA);
        rectA.setAttribute('width', barW);
        rectA.setAttribute('height', hA);
        rectA.setAttribute('fill', '#0ea5a8');
        svg.appendChild(rectA);

        // pop bar (right)
        const hP = (pop[i]/maxY)*(H-PAD.t-PAD.b);
        const yP = H-PAD.b - hP;
        const rectP = document.createElementNS('http://www.w3.org/2000/svg','rect');
        rectP.setAttribute('x', x0 + gap/2 + barW + 6);
        rectP.setAttribute('y', yP);
        rectP.setAttribute('width', barW);
        rectP.setAttribute('height', hP);
        rectP.setAttribute('fill', '#60a5fa');
        svg.appendChild(rectP);

        // x label
        const xl = document.createElementNS('http://www.w3.org/2000/svg','text');
        xl.setAttribute('x', x0 + band/2); xl.setAttribute('y', H-30);
        xl.setAttribute('text-anchor','middle'); xl.setAttribute('fill','#111111'); xl.setAttribute('font-size','12');
        xl.textContent = name; svg.appendChild(xl);

        // planned beds (annotation on allocation bar)
        const plannedBeds = scaleBeds(name, alloc[i]);
        const annA = document.createElementNS('http://www.w3.org/2000/svg','text');
        annA.setAttribute('x', x0 + gap/2 + barW/2);
        annA.setAttribute('y', yA-6);
        annA.setAttribute('text-anchor','middle');
        annA.setAttribute('fill','#111111');
        annA.setAttribute('font-size','11');
        if(plannedBeds.parts.length){
          annA.textContent = Math.round(alloc[i]) + '% (' + plannedBeds.parts.join('+') + ' = ' + plannedBeds.total + ' beds)';
        } else {
          annA.textContent = Math.round(alloc[i]) + '% (' + plannedBeds.total + ' beds)';
        }
        svg.appendChild(annA);

        // population annotation
        const annP = document.createElementNS('http://www.w3.org/2000/svg','text');
        annP.setAttribute('x', x0 + gap/2 + barW + 6 + barW/2);
        annP.setAttribute('y', yP-6);
        annP.setAttribute('text-anchor','middle');
        annP.setAttribute('fill','#1f2937');
        annP.setAttribute('font-size','11');
        annP.textContent = pop[i].toFixed(1) + '%';
        svg.appendChild(annP);

        // Gap visual
        const colorize = (val) => (val < 0 ? '#dc2626' : (val > 0 ? '#16a34a' : '#6b7280'));

        if (mode === 'parity') {
          // bracket between bar tops + label with % gap and bed equivalent difference
          const midLeft  = x0 + gap/2 + barW/2;
          const midRight = x0 + gap/2 + barW + 6 + barW/2;
          const yBracket = Math.min(yA, yP) - 14;
          const gapPct = alloc[i] - pop[i];
          const parityBeds = scaleBeds(name, pop[i]);
          const bedDiff = parityBeds.total - plannedBeds.total; // + means shortfall

          const color = colorize(gapPct);
          // ticks
          ['L','R'].forEach(side=>{
            const tick = document.createElementNS('http://www.w3.org/2000/svg','line');
            const x = side==='L' ? midLeft : midRight;
            tick.setAttribute('x1', x); tick.setAttribute('x2', x);
            tick.setAttribute('y1', yBracket); tick.setAttribute('y2', yBracket+8);
            tick.setAttribute('stroke', color); tick.setAttribute('stroke-width','2');
            svg.appendChild(tick);
          });
          const conn = document.createElementNS('http://www.w3.org/2000/svg','line');
          conn.setAttribute('x1', midLeft); conn.setAttribute('x2', midRight);
          conn.setAttribute('y1', yBracket); conn.setAttribute('y2', yBracket);
          conn.setAttribute('stroke', color); conn.setAttribute('stroke-width','2');
          svg.appendChild(conn);

          const label = document.createElementNS('http://www.w3.org/2000/svg','text');
          label.setAttribute('x', (midLeft+midRight)/2); label.setAttribute('y', yBracket-4);
          label.setAttribute('text-anchor','middle'); label.setAttribute('fill', color); label.setAttribute('font-size','11');
          const pctTxt = (gapPct===0)? 'Parity' : (gapPct < 0 ? `Shortfall ${Math.abs(gapPct).toFixed(1)}%` : `Surplus +${gapPct.toFixed(1)}%`);
          const bedTxt = (gapPct===0)? '' : ` (≈ ${Math.abs(bedDiff)} beds)`;
          label.textContent = pctTxt + bedTxt;
          svg.appendChild(label);
        } else {
          // baseline mode: label only (no bracket), computed as planned - current beds
          const baseBeds = baseline[name].beds;
          const bedDiffBase = plannedBeds.total - baseBeds;
          const color = colorize(bedDiffBase);
          const label = document.createElementNS('http://www.w3.org/2000/svg','text');
          label.setAttribute('x', x0 + gap/2 + barW/2);
          label.setAttribute('y', yA - 22);
          label.setAttribute('text-anchor','middle'); label.setAttribute('fill', color); label.setAttribute('font-size','11');
          if (bedDiffBase === 0) {
            label.textContent = `= ${baseBeds} beds (current)`;
          } else if (bedDiffBase > 0) {
            label.textContent = `+${bedDiffBase} beds vs current (${baseBeds})`;
          } else {
            label.textContent = `${bedDiffBase} beds vs current (${baseBeds})`;
          }
          svg.appendChild(label);
        }
      });
    }

    // Listeners
    document.getElementById('ref').addEventListener('input', () => { 
      const v = parseFloat(document.getElementById('ref').value);
      document.getElementById('ref-val').textContent = v.toFixed(1);
      draw(); 
    });
    popInputs.forEach((el, i) => el.addEventListener('input', () => { popVals[i].textContent = parseFloat(el.value).toFixed(1); draw(); }));
    allocInputs.forEach((el, i) => el.addEventListener('input', () => { allocVals[i].textContent = Math.round(parseFloat(el.value)); draw(); }));
    gapModeSelect.addEventListener('change', draw);

    // Reset
    document.getElementById('resetBtn').addEventListener('click', () => {
      document.getElementById('ref').value = defaults.ref;
      document.getElementById('ref-val').textContent = defaults.ref.toFixed(1);
      gapModeSelect.value = defaults.gapMode;
      popInputs.forEach((el, i) => { el.value = defaults.pops[i]; popVals[i].textContent = defaults.pops[i].toFixed(1); });
      allocInputs.forEach((el, i) => { el.value = defaults.allocs[i]; allocVals[i].textContent = Math.round(defaults.allocs[i]); });
      draw();
    });

    // Initial draw
    draw();
  </script>
</body>
</html>


